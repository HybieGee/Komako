---
import BaseLayout from '@layouts/BaseLayout.astro';
import GalleryGrid from '@components/GalleryGrid.astro';
import Lightbox from '@components/Lightbox.astro';
import { getAlbums, getPhotos } from '@lib/content';

export async function getStaticPaths() {
  const albums = await getAlbums();
  
  return albums.map((album) => ({
    params: { slug: album.slug },
    props: { album },
  }));
}

const { album } = Astro.props;
const photos = await getPhotos();
const albumPhotos = photos.filter(photo => photo.album === album.slug);
---

<BaseLayout
  title={`${album.title} - Komako Gallery`}
  description={album.summary}
  image={album.cover}
>
  <div class="container py-8">
    <header class="mb-8">
      <nav class="mb-4 text-sm">
        <a href="/albums" class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100">
          ‚Üê Back to albums
        </a>
      </nav>
      <h1 class="text-3xl font-bold">{album.title}</h1>
      <p class="mt-2 text-gray-600 dark:text-gray-400">
        {album.summary}
      </p>
      <div class="mt-4 text-sm text-gray-500 dark:text-gray-500">
        {albumPhotos.length} photos
      </div>
    </header>
    
    <GalleryGrid photos={albumPhotos} />
  </div>
  
  <Lightbox />
</BaseLayout>